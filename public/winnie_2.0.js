var app=function(e){"use strict";function t(){}function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e,t){for(var i in t)e[i]=1;return e}function r(e,t){return 0===t&&e(),function(){--t||e()}}function a(e){e()}function s(e,t){e.appendChild(t)}function o(e,t,i){e.insertBefore(t,i)}function l(e){e.parentNode.removeChild(e)}function c(e,t){for(var i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function d(e){return document.createElement(e)}function u(e){return document.createTextNode(e)}function h(){return document.createComment("")}function m(e,t,i,n){e.addEventListener(t,i,n)}function f(e,t,i,n){e.removeEventListener(t,i,n)}function p(e,t,i){null==i?e.removeAttribute(t):e.setAttribute(t,i)}function v(e,t){e.data=""+t}function g(e,t,i){e.style.setProperty(t,i)}function y(){return Object.create(null)}function _(e){e._lock=!0,k(e._beforecreate),k(e._oncreate),k(e._aftercreate),e._lock=!1}function b(e,t){e._handlers=y(),e._slots=y(),e._bind=t._bind,e._staged={},e.options=t,e.root=t.root||e,e.store=t.store||e.root.store,t.root||(e._beforecreate=[],e._oncreate=[],e._aftercreate=[])}function k(e){for(;e&&e.length;)e.shift()()}e=e&&e.hasOwnProperty("default")?e.default:e;var x={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(e,t){var i=e in this._handlers&&this._handlers[e].slice();if(i)for(var n=0;n<i.length;n+=1){var r=i[n];if(!r.__calling)try{r.__calling=!0,r.call(this,t)}finally{r.__calling=!1}}},on:function(e,t){var i=this._handlers[e]||(this._handlers[e]=[]);return i.push(t),{cancel:function(){var e=i.indexOf(t);~e&&i.splice(e,1)}}},set:function(e){this._set(i({},e)),this.root._lock||_(this.root)},_recompute:t,_set:function(e){var t=this._state,n={},r=!1;for(var a in e=i(this._staged,e),this._staged={},e)this._differs(e[a],t[a])&&(n[a]=r=!0);r&&(this._state=i(i({},t),e),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:t}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:t})))},_stage:function(e){i(this._staged,e)},_mount:function(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)},_differs:function(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}};function w(e){e.changed,e.current,e.previous}function T(e,t){var i,n;return{c:function(){(i=d("span")).className=n=t.type+" legendIconStyle  svelte-1vhs5pf",g(i,"background-color",t.backgroundColor),g(i,"border-color",t.borderColor)},m:function(e,t){o(e,i,t)},p:function(e,t){e.type&&n!==(n=t.type+" legendIconStyle  svelte-1vhs5pf")&&(i.className=n),e.backgroundColor&&g(i,"background-color",t.backgroundColor),e.borderColor&&g(i,"border-color",t.borderColor)},d:function(e){e&&l(i)}}}function C(e,t){var i,n;return{c:function(){(i=d("img")).src=n=t.item.RenderStyle.iconUrl,p(i,"crossorigin",""),i.alt="Style Icon",i.className="svelte-1vhs5pf"},m:function(e,t){o(e,i,t)},p:function(e,t){e.item&&n!==(n=t.item.RenderStyle.iconUrl)&&(i.src=n)},d:function(e){e&&l(i)}}}function N(e){var t=this;b(this,e),this._state=i({},e.data),this._recompute({item:1},this._state),this._intro=!!e.intro,this._handlers.state=[w],w.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(e,t){var i,n;function r(e){return e.item.RenderStyle.iconUrl?C:T}var s=r(t),c=s(e,t);return{c:function(){i=d("span"),c.c(),i.className="legendIconCell style svelte-1vhs5pf"},m:function(e,t){o(e,i,t),c.m(i,null),n=!0},p:function(t,n){s===(s=r(n))&&c?c.p(t,n):(c.d(1),(c=s(e,n)).c(),c.m(i,null))},i:function(e,t){n||this.m(e,t)},o:a,d:function(e){e&&l(i),c.d()}}}(this,this._state),this.root._oncreate.push(function(){t.fire("update",{changed:n({},t._state),current:t._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),_(this)),this._intro=!0}i(N.prototype,x),N.prototype._recompute=function(e,t){var i;e.item&&(this._differs(t.backgroundColor,t.backgroundColor=(i=t.item,L.gmxUtil.dec2rgba(i.RenderStyle.fillColor,i.RenderStyle.fillOpacity||1)))&&(e.backgroundColor=!0),this._differs(t.borderColor,t.borderColor=function(e){var t=e.item;return L.gmxUtil.dec2rgba(t.RenderStyle.color,t.RenderStyle.opacity||1)}(t))&&(e.borderColor=!0))};var D={isOpened:function(){var e=this.get(),t=e.line,i=e.layersTree,n=t.content,r=n.properties,a=r.name||r.GroupID||"root",s=i.visible[a]||i.expanded[a],o=void 0===s?r&&r.visible:s;return o&&r.GroupID&&n.children,o},toggleVisibility:function(e){var t="group"===this.get().line.type?this.refs.line.getElementsByClassName("expanderInput")[0]:e;t&&(t.checked?t.checked=!1:t.checked=!0,this.refs.ul&&this.refs.ul.classList[t.checked?"remove":"add"]("collapse"))},toggleBG:function(e,t){console.log(t,e.className)},toggleTimeline:function(e){e&&(e.classList.contains("disabled")?(e.classList.remove("disabled"),e.classList.add("enabled")):(e.classList.add("disabled"),e.classList.remove("enabled")))},showInfo:function(e){var t=e.parentNode.nextElementSibling.getElementsByClassName("description")[0];if(t)if(t.classList.contains("collapse")){var i=this.get().line;t.innerHTML=i.content.properties.description||"",t.classList.remove("collapse")}else t.classList.add("collapse")}};function I(e,t,i){var n=Object.create(e);return n.child=t[i],n}function S(e,t,i){var n=Object.create(e);return n.it=t[i],n}function E(e,t){var i,n,r,a="map"!==t.line.type&&M(e,t),s="map"!==t.line.type&&U(e,t);return{c:function(){a&&a.c(),i=u("\n "),s&&s.c(),n=h()},m:function(e,t){a&&a.m(e,t),o(e,i,t),s&&s.m(e,t),o(e,n,t),r=!0},p:function(t,r){"map"!==r.line.type?a?a.p(t,r):((a=M(e,r)).c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null),"map"!==r.line.type?(s?s.p(t,r):(s=U(e,r))&&s.c(),s.i(n.parentNode,n)):s&&s.o(function(){s.d(1),s=null})},i:function(e,t){r||this.m(e,t)},o:function(e){r&&(s?s.o(e):e(),r=!1)},d:function(e){a&&a.d(e),e&&l(i),s&&s.d(e),e&&l(n)}}}function M(e,t){var i,n,r="group"===t.line.type&&j(e,t),a="layer"===t.line.type&&P(e,t);return{c:function(){r&&r.c(),i=u("\n\t\t"),a&&a.c(),n=h()},m:function(e,t){r&&r.m(e,t),o(e,i,t),a&&a.m(e,t),o(e,n,t)},p:function(t,s){"group"===s.line.type?r?r.p(t,s):((r=j(e,s)).c(),r.m(i.parentNode,i)):r&&(r.d(1),r=null),"layer"===s.line.type?a?a.p(t,s):((a=P(e,s)).c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d:function(e){r&&r.d(e),e&&l(i),a&&a.d(e),e&&l(n)}}}function j(e,t){var i,n,r;function a(t){e.toggleVisibility(this)}return{c:function(){i=d("input"),n=u("\n\t"),r=d("span"),i.className="expander expanderInput hidden svelte-137ivxp",p(i,"type","checkbox"),i.checked=t.isVisible,m(r,"click",a),r.className="expander pointer expanderCont cmd:toggleVisibility svelte-137ivxp"},m:function(e,t){o(e,i,t),o(e,n,t),o(e,r,t)},p:function(e,t){e.isVisible&&(i.checked=t.isVisible)},d:function(e){e&&(l(i),l(n),l(r)),f(r,"click",a)}}}function P(e,t){var i,n,r,a,c,h=t.properties.styles.length>1&&V(e,t),m=t.properties.description&&B(e,t),f=t.gmxTimeline&&t.properties.Temporal&&(t.properties.IsRasterCatalog||t.properties.Quicklook&&"null"!==t.properties.Quicklook)&&R(e,t);return{c:function(){h&&h.c(),i=u("\n\t"),n=d("span"),m&&m.c(),r=u("\n \t\t"),(a=d("span")).innerHTML='<svg role="img" class="svgIcon svelte-137ivxp"><use xlink:href="#center-on-click" href="#center-on-click"></use></svg>',c=u("\n\t\t\t\n\t\t"),f&&f.c(),a.className="pointer cmd:fitBounds cont-center svelte-137ivxp",a.title="Move map to this layer",n.className="icons  svelte-137ivxp"},m:function(e,t){h&&h.m(e,t),o(e,i,t),o(e,n,t),m&&m.m(n,null),s(n,r),s(n,a),s(n,c),f&&f.m(n,null)},p:function(t,a){a.properties.styles.length>1?h||((h=V(e,a)).c(),h.m(i.parentNode,i)):h&&(h.d(1),h=null),a.properties.description?m||((m=B(e,a)).c(),m.m(n,r)):m&&(m.d(1),m=null),a.gmxTimeline&&a.properties.Temporal&&(a.properties.IsRasterCatalog||a.properties.Quicklook&&"null"!==a.properties.Quicklook)?f||((f=R(e,a)).c(),f.m(n,null)):f&&(f.d(1),f=null)},d:function(e){h&&h.d(e),e&&(l(i),l(n)),m&&m.d(),f&&f.d()}}}function V(e,t){var i;return{c:function(){(i=d("span")).innerHTML='<svg role="img" class="svgIcon svelte-137ivxp"><use xlink:href="#overlays" href="#overlays"></use></svg>',i.className="cont-overlays svelte-137ivxp"},m:function(e,t){o(e,i,t)},d:function(e){e&&l(i)}}}function B(e,t){var i;function n(t){e.showInfo(this,t)}return{c:function(){(i=d("span")).innerHTML='<svg role="img" class="svgIcon svelte-137ivxp"><use xlink:href="#info-circle-i" href="#info-circle-i"></use></svg>',m(i,"click",n),i.className="pointer cmd:showInfo cont-info svelte-137ivxp",i.title="View description"},m:function(e,t){o(e,i,t)},d:function(e){e&&l(i),f(i,"click",n)}}}function R(e,t){var i;function n(t){e.toggleTimeline(this)}return{c:function(){(i=d("span")).innerHTML='<svg role="img" class="svgIcon svelte-137ivxp"><use xlink:href="#timeline-icon" href="#timeline-icon"></use></svg>',m(i,"click",n),i.className="pointer cmd:toggleTimeline timeline disabled svelte-137ivxp"},m:function(e,t){o(e,i,t)},d:function(e){e&&l(i),f(i,"click",n)}}}function U(e,t){var i,n,a,c,h,g,y,_,b,L,k,x=t.properties.title;function w(t){e.toggleVisibility(this)}var T="layer"===t.line.type&&t.styles.length&&t.styles.length<2&&t.styles[0].RenderStyle&&A(e,t);function C(t){e.toggleVisibility(this)}var N="layer"===t.line.type&&O(e,t);return{c:function(){i=d("span"),n=d("input"),a=u("\n\t\t"),T&&T.c(),c=u("\n\t\t"),h=d("label"),g=u(x),_=u("\n\t\t"),b=d("div"),L=u("\n\t\t"),N&&N.c(),m(n,"click",w),n.className="check visibility pointer cmd:toggleVisibility svelte-137ivxp",p(n,"type","checkbox"),n.checked=t.isVisible,m(h,"click",C),h.className=y="pointer title cmd:toggleVisibility "+t.multiStyles+" svelte-137ivxp",b.className="description collapse svelte-137ivxp",i.className="cont"},m:function(e,t){o(e,i,t),s(i,n),s(i,a),T&&T.m(i,null),s(i,c),s(i,h),s(h,g),s(i,_),s(i,b),s(i,L),N&&N.m(i,null),k=!0},p:function(t,r){k&&!t.isVisible||(n.checked=r.isVisible),"layer"===r.line.type&&r.styles.length&&r.styles.length<2&&r.styles[0].RenderStyle?(T?T.p(t,r):(T=A(e,r))&&T.c(),T.i(i,c)):T&&T.o(function(){T.d(1),T=null}),k&&!t.properties||x===(x=r.properties.title)||v(g,x),k&&!t.multiStyles||y===(y="pointer title cmd:toggleVisibility "+r.multiStyles+" svelte-137ivxp")||(h.className=y),"layer"===r.line.type?(N?N.p(t,r):(N=O(e,r))&&N.c(),N.i(i,null)):N&&N.o(function(){N.d(1),N=null})},i:function(e,t){k||this.m(e,t)},o:function(e){k&&(e=r(e,2),T?T.o(e):e(),N?N.o(e):e(),k=!1)},d:function(e){e&&l(i),f(n,"click",w),T&&T.d(),f(h,"click",C),N&&N.d()}}}function A(e,t){var i,n={item:t.styles[0],type:t.properties.GeometryType},r=new N({root:e.root,store:e.store,data:n});return{c:function(){r._fragment.c()},m:function(e,t){r._mount(e,t),i=!0},p:function(e,t){var i={};e.styles&&(i.item=t.styles[0]),e.properties&&(i.type=t.properties.GeometryType),r._set(i)},i:function(e,t){i||this.m(e,t)},o:function(e){i&&(r&&r._fragment.o(e),i=!1)},d:function(e){r.destroy(e)}}}function O(e,t){var i,n,r=t.styles.length&&t.styles.length>1&&t.styles[0].RenderStyle&&H(e,t);return{c:function(){r&&r.c(),i=h()},m:function(e,t){r&&r.m(e,t),o(e,i,t),n=!0},p:function(t,n){n.styles.length&&n.styles.length>1&&n.styles[0].RenderStyle?(r?r.p(t,n):(r=H(e,n))&&r.c(),r.i(i.parentNode,i)):r&&r.o(function(){r.d(1),r=null})},i:function(e,t){n||this.m(e,t)},o:function(e){n&&(r?r.o(e):e(),n=!1)},d:function(e){r&&r.d(e),e&&l(i)}}}function H(e,t){for(var i,n,a,u=t.styles,h=[],m=0;m<u.length;m+=1)h[m]=W(e,S(t,u,m));function f(e,t,i){h[e]&&h[e].o(function(){t&&(h[e].d(t),h[e]=null),i&&i()})}return{c:function(){i=d("div"),n=d("div");for(var e=0;e<h.length;e+=1)h[e].c();n.className="legend-cont svelte-137ivxp",i.className="legend svelte-137ivxp"},m:function(e,t){o(e,i,t),s(i,n);for(var r=0;r<h.length;r+=1)h[r].i(n,null);a=!0},p:function(t,i){if(t.styles||t.properties){u=i.styles;for(var r=0;r<u.length;r+=1){var a=S(i,u,r);h[r]?h[r].p(t,a):(h[r]=W(e,a),h[r].c()),h[r].i(n,null)}for(;r<h.length;r+=1)f(r,1)}},i:function(e,t){a||this.m(e,t)},o:function(e){if(a){for(var t=r(e,(h=h.filter(Boolean)).length),i=0;i<h.length;i+=1)f(i,0,t);a=!1}},d:function(e){e&&l(i),c(h,e)}}}function W(e,t){var i,n,r,a,c,h,m,f=t.it.Name,p={item:t.it,type:t.properties.GeometryType},g=new N({root:e.root,store:e.store,data:p});return{c:function(){i=d("div"),n=d("span"),r=u("\n\t\t\t\t\t\t"),g._fragment.c(),a=u("\n\t\t\t\t\t\t"),c=d("span"),h=u(f),n.className="legendIconEye enabled pointer cmd:toggleStyle svelte-137ivxp",c.className="styleName svelte-137ivxp",i.className="gmx-style-legend svelte-137ivxp"},m:function(e,t){o(e,i,t),s(i,n),s(i,r),g._mount(i,null),s(i,a),s(i,c),s(c,h),m=!0},p:function(e,t){var i={};e.styles&&(i.item=t.it),e.properties&&(i.type=t.properties.GeometryType),g._set(i),m&&!e.styles||f===(f=t.it.Name)||v(h,f)},i:function(e,t){m||this.m(e,t)},o:function(e){m&&(g&&g._fragment.o(e),m=!1)},d:function(e){e&&l(i),g.destroy()}}}function G(e,t){for(var i,n,a,s=t.line.content.children||[],u=[],h=0;h<s.length;h+=1)u[h]=q(e,I(t,s,h));function m(e,t,i){u[e]&&u[e].o(function(){t&&(u[e].d(t),u[e]=null),i&&i()})}return{c:function(){i=d("ul");for(var e=0;e<u.length;e+=1)u[e].c();i.className=n="group css-treeview id_"+t.nodeID+" "+(t.isVisible||t.isRoot?"":"collapse")+" svelte-137ivxp"},m:function(t,n){o(t,i,n);for(var r=0;r<u.length;r+=1)u[r].i(i,null);e.refs.ul=i,a=!0},p:function(t,r){if(t.line||t.layersTree||t.gmxTimeline){s=r.line.content.children||[];for(var o=0;o<s.length;o+=1){var l=I(r,s,o);u[o]?u[o].p(t,l):(u[o]=q(e,l),u[o].c()),u[o].i(i,null)}for(;o<u.length;o+=1)m(o,1)}(!a||t.nodeID||t.isVisible||t.isRoot)&&n!==(n="group css-treeview id_"+r.nodeID+" "+(r.isVisible||r.isRoot?"":"collapse")+" svelte-137ivxp")&&(i.className=n)},i:function(e,t){a||this.m(e,t)},o:function(e){if(a){for(var t=r(e,(u=u.filter(Boolean)).length),i=0;i<u.length;i+=1)m(i,0,t);a=!1}},d:function(t){t&&l(i),c(u,t),e.refs.ul===i&&(e.refs.ul=null)}}}function q(e,t){var i,n={},r={line:t.child};void 0!==t.layersTree&&(r.layersTree=t.layersTree,n.layersTree=!0),void 0!==t.gmxTimeline&&(r.gmxTimeline=t.gmxTimeline,n.gmxTimeline=!0);var a=new z({root:e.root,store:e.store,data:r,_bind:function(t,i){var r={};!n.layersTree&&t.layersTree&&(r.layersTree=i.layersTree),!n.gmxTimeline&&t.gmxTimeline&&(r.gmxTimeline=i.gmxTimeline),e._set(r),n={}}});return e.root._beforecreate.push(function(){a._bind({layersTree:1,gmxTimeline:1},a.get())}),{c:function(){a._fragment.c()},m:function(e,t){a._mount(e,t),i=!0},p:function(e,i){t=i;var r={};e.line&&(r.line=t.child),!n.layersTree&&e.layersTree&&(r.layersTree=t.layersTree,n.layersTree=void 0!==t.layersTree),!n.gmxTimeline&&e.gmxTimeline&&(r.gmxTimeline=t.gmxTimeline,n.gmxTimeline=void 0!==t.gmxTimeline),a._set(r),n={}},i:function(e,t){i||this.m(e,t)},o:function(e){i&&(a&&a._fragment.o(e),i=!1)},d:function(e){a.destroy(e)}}}function z(e){var t,n,a,c,h,m,f,p,v;b(this,e),this.refs={},this._state=i({line:null},e.data),this._recompute({line:1,properties:1,layersTree:1},this._state),this._intro=!!e.intro,this._fragment=(t=this,n=this._state,p=n.properties&&E(t,n),v=n.line.content.children&&G(t,n),{c:function(){a=d("li"),c=d("div"),p&&p.c(),h=u("\n\n\n"),v&&v.c(),c.className="mega",a.className=m="line cmd:toggleIcons id:"+n.nodeID+" svelte-137ivxp"},m:function(e,i){o(e,a,i),s(a,c),p&&p.m(c,null),s(a,h),v&&v.m(a,null),t.refs.line=a,f=!0},p:function(e,i){i.properties?(p?p.p(e,i):(p=E(t,i))&&p.c(),p.i(c,null)):p&&p.o(function(){p.d(1),p=null}),i.line.content.children?(v?v.p(e,i):(v=G(t,i))&&v.c(),v.i(a,null)):v&&v.o(function(){v.d(1),v=null}),f&&!e.nodeID||m===(m="line cmd:toggleIcons id:"+i.nodeID+" svelte-137ivxp")||(a.className=m)},i:function(e,t){f||this.m(e,t)},o:function(e){f&&(e=r(e,2),p?p.o(e):e(),v?v.o(e):e(),f=!1)},d:function(e){e&&l(a),p&&p.d(),v&&v.d(),t.refs.line===a&&(t.refs.line=null)}}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),_(this)),this._intro=!0}i(z.prototype,x),i(z.prototype,D),z.prototype._recompute=function(e,t){e.line&&this._differs(t.properties,t.properties=t.line.content.properties)&&(e.properties=!0),e.properties&&(this._differs(t.nodeID,t.nodeID=function(e){var t=e.properties;return t?t.name||t.GroupID:"root"}(t))&&(e.nodeID=!0),this._differs(t.styles,t.styles=function(e){var t=e.properties;return t.gmxStyles?t.gmxStyles.styles:[]}(t))&&(e.styles=!0),this._differs(t.multiStyles,t.multiStyles=function(e){var t=e.properties;return t.gmxStyles&&t.gmxStyles.styles.length>1?"multiStyles":""}(t))&&(e.multiStyles=!0),this._differs(t.isRoot,t.isRoot=function(e){return e.properties.MapID}(t))&&(e.isRoot=!0)),(e.line||e.layersTree)&&this._differs(t.isVisible,t.isVisible=function(e){var t=e.line,i=e.layersTree,n=t.content.properties,r=n.name||n.GroupID||"root",a=i.visible[r]||i.expanded[r];return void 0===a?n&&n.visible:a}(t))&&(e.isVisible=!0)};var Q={cmd:/cmd:(\w+)/,id:/id:(\w+)/};var $={chkEvent:function(e){var t=e.target,i=t.className,n=Q.cmd.exec(i);if(n&&2===n.length){for(var r={cmd:n[1],type:e.type,originalEvent:e},a=0;a<10;a++){if(t.classList.contains("line")){(n=Q.id.exec(t.className))&&2===n.length&&(r.id=n[1]),r.target=t;break}t=t.parentNode}r.id&&(this.treeCommands(r),this.fire("command",r))}},treeCommands:function(e){var t=this.get(),i=t.layersTree;t.rawTree;if("toggleVisibility"===e.cmd){var n=e.target.getElementsByClassName("expanderInput")[0],r=n||e.target.getElementsByClassName("visibility")[0],a=(e.originalEvent.target,n?i.expanded:i.visible),s=e.id;return a[s]?(delete a[s],r.checked=!1):(a[s]=!0,r.checked=!0),this.set({layersTree:i}),!0}return!1},appendNode:function(e){this.options.appendNode(e)}};function Z(e){b(this,e),this._state=i({config:{},layersTree:{visible:{},expanded:{}},group:null,rawTree:null},e.data),this._intro=!!e.intro,this._fragment=function(e,t){var i,n,r={},a={line:t.rawTree};void 0!==t.layersTree&&(a.layersTree=t.layersTree,r.layersTree=!0),void 0!==t.gmxTimeline&&(a.gmxTimeline=t.gmxTimeline,r.gmxTimeline=!0);var s=new z({root:e.root,store:e.store,data:a,_bind:function(t,i){var n={};!r.layersTree&&t.layersTree&&(n.layersTree=i.layersTree),!r.gmxTimeline&&t.gmxTimeline&&(n.gmxTimeline=i.gmxTimeline),e._set(n),r={}}});function c(t){e.chkEvent(t)}return e.root._beforecreate.push(function(){s._bind({layersTree:1,gmxTimeline:1},s.get())}),{c:function(){i=d("div"),s._fragment.c(),m(i,"click",c),i.className="TreeView svelte-aljqq6"},m:function(e,t){o(e,i,t),s._mount(i,null),n=!0},p:function(e,i){t=i;var n={};e.rawTree&&(n.line=t.rawTree),!r.layersTree&&e.layersTree&&(n.layersTree=t.layersTree,r.layersTree=void 0!==t.layersTree),!r.gmxTimeline&&e.gmxTimeline&&(n.gmxTimeline=t.gmxTimeline,r.gmxTimeline=void 0!==t.gmxTimeline),s._set(n),r={}},i:function(e,t){n||this.m(e,t)},o:function(e){n&&(s&&s._fragment.o(e),n=!1)},d:function(e){e&&l(i),s.destroy(),f(i,"click",c)}}}(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),_(this)),this._intro=!0}i(Z.prototype,x),i(Z.prototype,$);var J=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},F=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),K=function(){function e(){J(this,e),this.listeners={}}return F(e,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"on",value:function(e,t){return this.addEventListener(e,t),this}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var i=this.listeners[e],n=0,r=i.length;n<r;n++)if(i[n]===t)return i.splice(n,1),this.removeEventListener(e,t)}},{key:"off",value:function(e,t){return this.removeEventListener(e,t),this}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){var t=this.listeners[e.type];Object.defineProperty(e,"target",{enumerable:!1,configurable:!1,writable:!1,value:this});for(var i=0,n=t.length;i<n;i++)t[i].call(this,e)}}}]),e}();class X extends K{constructor(e,{position:t="left"}={}){super(),this._container=e,this._container.classList.add("noselect"),this._container.innerHTML=`<div class="scanex-sidebar">\n            <div class="${"left"===t?"tabs":"panes"}"></div>\n            <div class="${"left"===t?"panes":"tabs"}"></div>\n        </div>`,this._tabContainer=this._container.querySelector(".tabs"),this._paneContainer=this._container.querySelector(".panes"),this._current=null,this._data={}}enable(e){this._data[e]&&(this._data[e].enabled=!0)}enabled(e){const{enabled:t}=e&&this._data[e]?this._data[e]:{enabled:!1};return t}disable(e){this._data[e]&&(e===this.current&&(this.current=null),this._data[e].enabled=!1)}get current(){return this._current}set current(e){const t=this._tabContainer.children,i=this._paneContainer.children;let n=!1;for(let r=0;r<t.length;++r){const a=t[r].getAttribute("data-tab-id"),{opened:s,closed:o,enabled:l}=this._data[a];let c=t[r].querySelector("i"),d=i[r];a===e?(c.classList.remove(o),c.classList.add(s),d.classList.remove("hidden"),d.classList.add("shown"),n=!0):(c.classList.remove(s),c.classList.add(o),d.classList.remove("shown"),d.classList.add("hidden"))}this._current=n?e:null;let r=document.createEvent("Event");r.detail={current:this._current},r.initEvent("change",!1,!1),this.dispatchEvent(r)}addTab({id:e,icon:t,opened:i,closed:n,tooltip:r,enabled:a=!0}){let s=document.createElement("div"),o=document.createElement("i");t.split(/\s+/g).forEach(e=>o.classList.add(e)),o.classList.add(e===this._current?i:n),s.appendChild(o),s.setAttribute("data-tab-id",e),r&&s.setAttribute("title",r),s.addEventListener("click",this._toggle.bind(this,e)),this._tabContainer.appendChild(s);let l=document.createElement("div");return l.setAttribute("data-pane-id",e),l.classList.add(this.visible&&this.current===e?"shown":"hidden"),this._paneContainer.appendChild(l),this._data[e]={icon:t,opened:i,closed:n,enabled:a},l}removeTab(e){const t=this._tabContainer.querySelector(`[data-tab-id=${e}]`);t.removeEventListener("click",this._toggle.bind(this,e)),this._tabContainer.removeChild(t);const i=this._paneContainer.querySelector(`[data-pane-id=${e}]`);this._paneContainer.removeChild(i);for(let t=0;t<this._data.length;++t)if(this._data[t].id===e){this._data.splice(t,1);break}}_toggle(e){this.enabled(e)&&(this.current=this.current===e?null:e)}getPane(e){return this._paneContainer.querySelector(`[data-pane-id=${e}]`)}}var Y=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,initialize:function(e){L.setOptions(this,e)},enable:function(e){this._sidebar.enable(e)},enabled:function(e){return this._sidebar.enabled(e)},disable:function(e){this._sidebar.disable(e)},getCurrent:function(){return this._sidebar.current},setCurrent:function(e){this._sidebar.current=e},addTab:function({id:e,icon:t,opened:i,closed:n,tooltip:r,enabled:a}){return this._sidebar.addTab({id:e,icon:t,opened:i,closed:n,tooltip:r,enabled:a})},removeTab:function(e){this._sidebar.removeTab(e)},getPane:function(e){return this._sidebar.getPane(e)},onAdd:function(e){this._container=L.DomUtil.create("div"),L.DomEvent.disableClickPropagation(this._container),L.DomEvent.disableScrollPropagation(this._container);const{position:t}=this.options;return this._sidebar=new X(this._container,{position:"topleft"===t||"bottomleft"===t?"left":"right"}),this._sidebar.addEventListener("change",e=>{this.fire("change",e)}),this._container},addTo:function(e){return L.Control.prototype.addTo.call(this,e),this.options.addBefore&&this.addBefore(this.options.addBefore),this},addBefore:function(e){let t=this._parent&&this._parent._container;if(t||(t=this._map&&this._map._controlCorners[this.getPosition()]),t)for(let i=0,n=t.childNodes.length;i<n;i++){let n=t.childNodes[i];if(e===n._id){t.insertBefore(this._container,n);break}}else this.options.addBefore=e;return this}});var ee,te=(function(t){var i;i=function(e){function t(e,t){for(var i in e)e.hasOwnProperty(i)&&t(e[i],i,e)}function i(e,t){e.children.length?e.insertBefore(t,e.children[0]):e.appendChild(t)}var n=e.Control.extend({includes:e.Evented?e.Evented.prototype:e.Mixin.Events,_getActiveLayer:function(){return this._activeLayerId?this._layers[this._activeLayerId]:function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&t++;return t}(this._layers)?function(e){for(var t in e)if(e.hasOwnProperty(t))return e[t]}(this._layers):null},_getPreviousLayer:function(){var e=this._getActiveLayer();return e?this._previousLayerId?this._layers[this._previousLayerId]:function(e,t){if(e.length){for(var i=0;i<e.length;i++)if(t(e[i]))return e[i]}else for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return e[n]}(this._layers,function(t){return t.id!==e.id}.bind(this))||null:null},_getInactiveLayers:function(){var e=[],i=this._getActiveLayer()?this._getActiveLayer().id:null,n=this._getPreviousLayer()?this._getPreviousLayer().id:null;return t(this._layers,function(t){t.id!==i&&t.id!==n&&e.push(t)}),e},_arrangeLayers:function(){var e={previous:function(){var e=this._getInactiveLayers();return this._getActiveLayer()&&e.unshift(this._getActiveLayer()),this._getPreviousLayer()&&e.unshift(this._getPreviousLayer()),e}};return e[this.options.behavior].apply(this,arguments)},_getLayerCellByLayerId:function(e){for(var t=this._container.getElementsByClassName("leaflet-iconLayers-layerCell"),i=0;i<t.length;i++)if(t[i].getAttribute("data-layerid")==e)return t[i]},_createLayerElement:function(t){var i=e.DomUtil.create("div","leaflet-iconLayers-layer");if(t.title){var n=e.DomUtil.create("div","leaflet-iconLayers-layerTitleContainer"),r=e.DomUtil.create("div","leaflet-iconLayers-layerTitle"),a=e.DomUtil.create("div","leaflet-iconLayers-layerCheckIcon");r.innerHTML=t.title,n.appendChild(r),i.appendChild(n),i.appendChild(a)}return t.icon&&i.setAttribute("style","background-image: url('"+t.icon+"')"),i},_createLayerElements:function(){for(var t,n,r=this._arrangeLayers(),a=this._getActiveLayer()&&this._getActiveLayer().id,s=0;s<r.length;s++)s%this.options.maxLayersInRow==0&&(t=e.DomUtil.create("div","leaflet-iconLayers-layersRow"),-1===this.options.position.indexOf("bottom")?this._container.appendChild(t):i(this._container,t)),(n=e.DomUtil.create("div","leaflet-iconLayers-layerCell")).setAttribute("data-layerid",r[s].id),0!==s&&e.DomUtil.addClass(n,"leaflet-iconLayers-layerCell_hidden"),r[s].id===a&&e.DomUtil.addClass(n,"leaflet-iconLayers-layerCell_active"),"left"===this._expandDirection?e.DomUtil.addClass(n,"leaflet-iconLayers-layerCell_expandLeft"):e.DomUtil.addClass(n,"leaflet-iconLayers-layerCell_expandRight"),n.appendChild(this._createLayerElement(r[s])),-1===this.options.position.indexOf("right")?t.appendChild(n):i(t,n)},_onLayerClick:function(e){e.stopPropagation();var t=e.currentTarget.getAttribute("data-layerid"),i=this._layers[t];this.setActiveLayer(i.layer),this.expand()},_attachEvents:function(){t(this._layers,function(e){var t=this._getLayerCellByLayerId(e.id);t&&t.addEventListener("click",this._onLayerClick.bind(this))}.bind(this));for(var e=this._container.getElementsByClassName("leaflet-iconLayers-layersRow"),i=function(e){e.stopPropagation(),this.expand()}.bind(this),n=function(e){e.stopPropagation(),this.collapse()}.bind(this),r=function(e){e.stopPropagation()},a=0;a<e.length;a++){var s=e[a];s.addEventListener("mouseenter",i),s.addEventListener("mouseleave",n),s.addEventListener("mousemove",r)}},_render:function(){this._container.innerHTML="",this._createLayerElements(),this._attachEvents()},_switchMapLayers:function(){if(this._map){var e=this._getActiveLayer(),i=this._getPreviousLayer();i?this._map.removeLayer(i.layer):t(this._layers,function(e){var t=e.layer;this._map.removeLayer(t)}.bind(this)),e&&this._map.addLayer(e.layer)}},options:{position:"bottomleft",behavior:"previous",expand:"horizontal",autoZIndex:!0,maxLayersInRow:5,manageLayers:!0},initialize:function(t,i){e.Util.isArray(arguments[0])||(i=t,t=[]),e.setOptions(this,i),this._expandDirection=-1!=this.options.position.indexOf("left")?"right":"left",this.options.manageLayers&&this.on("activelayerchange",this._switchMapLayers,this),this.setLayers(t)},onAdd:function(t){return this._container=e.DomUtil.create("div","leaflet-iconLayers"),e.DomUtil.addClass(this._container,"leaflet-iconLayers_"+this.options.position),this._render(),t.on("click",this.collapse,this),this.options.manageLayers&&this._switchMapLayers(),this._container},onRemove:function(e){e.off("click",this.collapse,this)},setLayers:function(t){this._layers={},t.map(function(t){var i=e.stamp(t.layer);this._layers[i]=e.extend(t,{id:i})}.bind(this)),this._container&&this._render()},setActiveLayer:function(t){var i=t&&this._layers[e.stamp(t)];i&&i.id!==this._activeLayerId&&(this._previousLayerId=this._activeLayerId,this._activeLayerId=i.id,this._container&&this._render(),this.fire("activelayerchange",{layer:t}))},expand:function(){this._arrangeLayers().slice(1).map(function(t){var i=this._getLayerCellByLayerId(t.id);e.DomUtil.removeClass(i,"leaflet-iconLayers-layerCell_hidden")}.bind(this))},collapse:function(){this._arrangeLayers().slice(1).map(function(t){var i=this._getLayerCellByLayerId(t.id);e.DomUtil.addClass(i,"leaflet-iconLayers-layerCell_hidden")}.bind(this))}}),r=function(e,t){return new n(e,t)};return r.Constructor=n,r},t.exports?t.exports=i(e):(window.L.control.iconLayers=i(window.L),window.L.Control.IconLayers=window.L.control.iconLayers.Constructor)}(ee={exports:{}},ee.exports),ee.exports);window.serverBase;var ie={createMap:function(e){var t=this.get().layersTree,i=e.app||{},n=i.gmxMap||{},r=e.state||{},a=(r.calendar,n.mapID||"946GH"),s=n.apiKey||"Z2SSNR87N4",o=r.map?r.map.position:{};i.theme&&document.body.classList.add(i.theme),L.leafletMap&&L.leafletMap.remove(),t=r.layersTree||t,this.layersTree=t;var l=new L.Map("map",{srs:3857,layers:[],center:new L.LatLng(o.y||0,o.x||60),zoom:o.z||3});if(L.leafletMap=l,l.gmxControlsManager.init({gmxDrawing:i.drawing&&"false"!==i.drawing?{position:"right"}:null,gmxZoom:{position:"gmxbottomright"},gmxHide:null}),l.gmxControlsManager.setSvgSprites("//www.kosmosnimki.ru/lib/geomixer_1.3/img/svg-symbols.svg"),i.iconSidebar&&"false"!==i.iconSidebar){var c=new Y({position:"topleft"});if(c.addTo(l),this.iconSidebar=c,i.treeView&&"false"!==i.treeView){var d=c.addTab({id:"treeView",icon:"icon-layers",opened:"opened",closed:"closed"});this.treePane=d}}else document.body.classList.add("noIconSidebar");this.mapID=a;var u={leafletMap:l,apiKey:s,setZIndex:!0};L.gmx.loadMap(a,u).then(function(e){var n=this;this.gmxMap=e;var a=r.calendar||{},s=a.dateBegin,o=a.dateEnd;if(!s){var c=new Date;o=(s=Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()))+864e5}var u=new Date(s),h=new Date(o);e.layers.forEach(function(e){if(e.getGmxProperties){var i=e.getGmxProperties().name;e.setDateInterval&&e.setDateInterval(u,h),i in t.visible&&l[t.visible[i]?"addLayer":"removeLayer"](e)}});var m=!1,f=null;if(i.gmxTimeline&&"false"!==i.gmxTimeline){var p=L.control.gmxTimeline({moveable:!0}).on("dateInterval",function(t){e.layersByID[t.layerID].setDateInterval(t.beginDate,t.endDate)}).on("statechanged",function(){f()}).on("click",function(t){e.layersByID[t.layerID].repaint()});this.gmxTimeline=p,f=function(){p._container&&(p._container.classList[m?"add":"remove"]("shiftTimeline"),p._redrawTimeline())}}if(this.iconSidebar){this.iconSidebar.on("change",function(i){return"treeView"===i.detail.current?(m=!0,d&&n._initTree({container:d,layersTree:t,rawTree:e.rawTree,gmxTimeline:n.gmxTimeline})):(m=!1,d&&(d.innerHTML="")),n.IconLayersContainer&&n.IconLayersContainer.classList[m?"add":"remove"]("shiftIconLayers"),void(f&&f())})}var v=r.baseLayersManager||{activeIDs:e.properties.BaseLayers};this._initBaseLayers(l,v,i)}.bind(this)).catch(console.log),this.set({map:l,config:e})},_initBaseLayers:function(e,t,i){var n=e.gmxBaseLayersManager,r=t.activeIDs||["sputnik"],a=t.currentID||r[0];n.initDefaults().then(function(){n.setActiveIDs(r);var t=n.getActiveIDs().map(function(e){var t=n.get(e);return t?{layer:t,icon:t.options.icon,title:t.options.rus}:null}).filter(function(e){return e});if(i.iconLayers&&"false"!==i.iconLayers){var s=new te(t,{id:"iconLayers"});e.gmxControlsManager.add(s),e.addControl(s),s.setActiveLayer(n.get(a)),this.IconLayersContainer=s.getContainer()}n.setCurrentID(a),"opened"===i.treeView&&this.iconSidebar&&this.iconSidebar.setCurrent("treeView")}.bind(this))},_getNodeIndex:function(e){var t,i,n=e.parentNode.children;for(t=0,i=n.length;t<i&&n[t]!==e;t++);return t===i?null:t},_initTree:function(e){var t=this,i={type:"map",content:e.rawTree};this._treeView=new Z({appendNode:function(e){},target:e.container,data:{container:e.container,layersTree:e.layersTree,gmxTimeline:!!e.gmxTimeline,rawTree:i}}),this._treeView.on("command",function(e){var i=t.get().map,n=e.cmd,r=e.originalEvent.target,a=t.gmxMap,s=!a.nodes||a.nodes[e.id],o=a.layersByID[e.id];if(o){if("fitBounds"===n)i.fitBounds(o.getBounds());else if("toggleVisibility"===n)o._map?i.removeLayer(o):i.addLayer(o);else if("toggleTimeline"===n&&t.gmxTimeline)r.classList.contains("enabled")?(t.gmxTimeline._map||i.addControl(t.gmxTimeline),t.gmxTimeline.addLayer(o)):t.gmxTimeline.removeLayer(o);else if("toggleStyle"===n){var l=t._getNodeIndex(r.parentNode),c=o.getStyles();r.classList.contains("enabled")?(r.classList.remove("enabled"),c[l].disabled=!0):(r.classList.add("enabled"),delete c[l].disabled),o.setStyles(c)}}else"toggleVisibility"!==n||s||t._treeView.appendNode(e.id)})}};function ne(e){var t=e.changed,i=e.current;e.previous;t.permalink&&i.permalink&&this.createMap(i.permalink)}function re(e){var r,s,c=this;b(this,e),this._state=i({layersTree:{visible:{},expanded:{}},permalink:null,map:null},e.data),this._intro=!!e.intro,this._handlers.state=[ne],ne.call(this,{changed:n({},this._state),current:this._state}),this._fragment=(this._state,{c:function(){(r=d("div")).id="map"},m:function(e,t){o(e,r,t),s=!0},p:t,i:function(e,t){s||this.m(e,t)},o:a,d:function(e){e&&l(r)}}),this.root._oncreate.push(function(){c.fire("update",{changed:n({},c._state),current:c._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),_(this)),this._intro=!0}function ae(e,t){var i,n;return{c:function(){i=d("h3"),n=u(t.title),i.className="popover-title"},m:function(e,t){o(e,i,t),s(i,n)},p:function(e,t){e.title&&v(n,t.title)},d:function(e){e&&l(i)}}}function se(e){b(this,e),this._state=i({frameWidth:800,frameHeight:600,conf:"R6UIY",title:""},e.data),this._recompute({conf:1},this._state),this._intro=!!e.intro,this._fragment=function(e,t){var i,n,r,c,h,v,g,y,_,b,L,k,x,w,T,C,N,D,I,S,E,M,j,P,V,B,R,U,A,O,H,W,G,q,z,Q,$,Z,J,F,K,X,Y,ee,te,ie,ne,re,se,oe,le,ce,de,ue,he,me,fe,pe,ve,ge,ye=t.title&&ae(0,t);function _e(t){e.set({frameWidth:this.value})}function be(t){e.set({frameHeight:this.value})}return{c:function(){i=d("div"),n=d("div"),r=u("\n\t"),ye&&ye.c(),c=u("\n\t"),h=d("div"),v=d("div"),g=d("div"),y=d("div"),(_=d("span")).textContent="Ссылка на карту:",b=u("\n\t\t\t\t\t"),L=d("a"),k=d("i"),w=u("\n\t\t\t\t\t"),T=d("a"),C=d("i"),D=u("\n\t\t\t\t\t"),I=d("a"),S=d("i"),M=u("\n\t\t\t\t"),j=d("div"),P=d("div"),V=d("input"),B=u("\n\t\t\t\t\t\t"),R=d("a"),U=d("i"),A=u("\n\t\t\t\t"),(O=d("div")).textContent="Код для вставки:",H=u("\n\t\t\t\t"),W=d("div"),G=d("div"),q=d("input"),z=u("\n\t\t\t\t\t\t\t"),(Q=d("span")).textContent="x",$=u("\n\t\t\t\t\t\t\t"),Z=d("input"),J=u("\n\t\t\t\t\t\t"),(F=d("span")).innerHTML='<span>предпросмотр</span><i class="icon-link-ext svelte-1cva6jy"></i>',K=u("\n\t\t\t\t\t\t"),X=d("span"),Y=d("a"),ee=u("конструктор приложений"),ie=d("i"),ne=u("\n\t\t\t\t"),re=d("div"),se=d("textarea"),le=u("\n\t\t\t\t\t"),(ce=d("div")).innerHTML='<div class="alertWidget ui-widget"></div>',de=u("\n\t\t\t\t"),ue=d("div"),he=d("span"),me=d("a"),fe=u("предпросмотр"),ve=d("i"),n.className="arrow svelte-1cva6jy",_.className="bold svelte-1cva6jy",k.className="icon-twitter svelte-1cva6jy",L.className="gmx-link_icon svelte-1cva6jy",L.target="_blank",L.href=x="//www.twitter.com/share?url="+t.link,C.className="icon-facebook svelte-1cva6jy",T.className="gmx-link_icon svelte-1cva6jy",T.target="_blank",T.href=N="https://www.facebook.com/sharer/sharer.php?u="+t.link,S.className="icon-vk svelte-1cva6jy",I.className="gmx-link_icon svelte-1cva6jy",I.target="_blank",I.href=E="//vkontakte.ru/share.php?url"+t.link,y.className="shareDialog-row shareDialog-title svelte-1cva6jy",V.className="shareDialog-inputPermalinkUrl svelte-1cva6jy",p(V,"type","text"),V.readOnly="readonly",V.value=t.link,U.className="icon-link-ext svelte-1cva6jy",U.title="открыть в новом окне",R.className="gmx-link_icon svelte-1cva6jy",R.target="_blank",R.href=t.link,P.className="gmx-table",j.className="shareDialog-row svelte-1cva6jy",O.className="shareDialog-row bold svelte-1cva6jy",m(q,"change",_e),q.className=" svelte-1cva6jy",p(q,"type","number"),q.value=t.frameWidth,Q.className="shareDialog-resolutionCross",m(Z,"change",be),Z.className=" svelte-1cva6jy",p(Z,"type","number"),Z.value=t.frameHeight,F.className="shareDialog-validationError hidden svelte-1cva6jy",Y.className="shareDialog-previewLink gmx-link svelte-1cva6jy",Y.href=te=t.link+"&edit=1",Y.target="_blank",ie.className="gmx-icon icon-link-ext svelte-1cva6jy",X.className="shareDialog-previewLinkCell constrLink shareDialog-validationOk svelte-1cva6jy",G.className="gmx-table shareDialog-resolutionTable svelte-1cva6jy",W.className="shareDialog-row svelte-1cva6jy",se.className="shareDialog-validationOk svelte-1cva6jy",se.readOnly="readonly",se.value=oe='<iframe src="'+t.link+'" width="'+t.frameWidth+'" height="'+t.frameHeight+'"></iframe>',ce.className="shareDialog-validationErrorView hidden svelte-1cva6jy",re.className="shareDialog-row svelte-1cva6jy",me.className="shareDialog-previewLink gmx-link svelte-1cva6jy",me.href=pe="//www.kosmosnimki.ru/demo/winnie_2.0/iframePreview.html?width="+t.frameWidth+"&height="+t.frameHeight+"&url="+t.link,me.target="_blank",ve.className="gmx-icon icon-link-ext svelte-1cva6jy",he.className="shareDialog-previewLinkCell shareDialog-validationOk svelte-1cva6jy",ue.className="shareDialog-row svelte-1cva6jy",g.className="shareDialog",v.className="shareDialogContainer",h.className="popover-content svelte-1cva6jy",i.className="share svelte-1cva6jy"},m:function(e,t){o(e,i,t),s(i,n),s(i,r),ye&&ye.m(i,null),s(i,c),s(i,h),s(h,v),s(v,g),s(g,y),s(y,_),s(y,b),s(y,L),s(L,k),s(y,w),s(y,T),s(T,C),s(y,D),s(y,I),s(I,S),s(g,M),s(g,j),s(j,P),s(P,V),s(P,B),s(P,R),s(R,U),s(g,A),s(g,O),s(g,H),s(g,W),s(W,G),s(G,q),s(G,z),s(G,Q),s(G,$),s(G,Z),s(G,J),s(G,F),s(G,K),s(G,X),s(X,Y),s(Y,ee),s(X,ie),s(g,ne),s(g,re),s(re,se),s(re,le),s(re,ce),s(g,de),s(g,ue),s(ue,he),s(he,me),s(me,fe),s(he,ve),ge=!0},p:function(e,t){t.title?ye?ye.p(e,t):((ye=ae(0,t)).c(),ye.m(i,c)):ye&&(ye.d(1),ye=null),e.link&&x!==(x="//www.twitter.com/share?url="+t.link)&&(L.href=x),e.link&&N!==(N="https://www.facebook.com/sharer/sharer.php?u="+t.link)&&(T.href=N),e.link&&E!==(E="//vkontakte.ru/share.php?url"+t.link)&&(I.href=E),e.link&&(V.value=t.link,R.href=t.link),e.frameWidth&&(q.value=t.frameWidth),e.frameHeight&&(Z.value=t.frameHeight),e.link&&te!==(te=t.link+"&edit=1")&&(Y.href=te),(e.link||e.frameWidth||e.frameHeight)&&oe!==(oe='<iframe src="'+t.link+'" width="'+t.frameWidth+'" height="'+t.frameHeight+'"></iframe>')&&(se.value=oe),(e.frameWidth||e.frameHeight||e.link)&&pe!==(pe="//www.kosmosnimki.ru/demo/winnie_2.0/iframePreview.html?width="+t.frameWidth+"&height="+t.frameHeight+"&url="+t.link)&&(me.href=pe)},i:function(e,t){ge||this.m(e,t)},o:a,d:function(e){e&&l(i),ye&&ye.d(),f(q,"change",_e),f(Z,"change",be)}}}(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor)),this._intro=!0}i(re.prototype,x),i(re.prototype,ie),i(se.prototype,x),se.prototype._recompute=function(e,t){e.conf&&this._differs(t.link,t.link="//www.kosmosnimki.ru/demo/winnie_2.0/?config="+t.conf)&&(e.link=!0)};var oe=window.serverBase||"//maps.kosmosnimki.ru/",le=function(e,t,i,n){return t[e]||(e in i?i[e]:n||!0)};var ce={checkMe:function(e,t){var i=this,n=e.name,r=this.editor.getValue(),a=null;try{a=JSON.parse(r)}catch(e){var s=this.editor.getSession().getAnnotations()[0];alert("Ошибка в конфигурации:\n строка: "+s.row+"\n позиция: "+s.column+"\n сообщение: "+s.text),console.log("error in json: ",s)}if(a)if("refresh"===n)this.set({permalink:a});else if("link"===n){this.get().share?(t.classList.remove("checked"),this.set({share:!1})):(t.classList.add("checked"),fetch(oe+"TinyReference/Create.ashx",{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:L.gmxUtil.getFormData({WrapStyle:"None",content:a}),mode:"cors",credentials:"include"}).then(function(e){return e.json()}).then(function(e){"ok"===e.Status&&i.set({share:!0,conf:e.Result})}).catch(console.error))}},checkPermalink:function(e){var t=this.get().urlParams;if(e.app&&(e.app.theme=le("theme",t,e.app,"dark"),e.app.iconSidebar=le("iconSidebar",t,e.app),e.app.treeView=le("treeView",t,e.app),e.app.iconLayers=le("iconLayers",t,e.app),e.app.drawing=le("drawing",t,e.app),e.app.gmxTimeline=le("gmxTimeline",t,e.app)),this.set({permalink:e}),t.edit){var i=ace.edit("editor");i.setTheme("ace/theme/monokai"),i.getSession().setMode("ace/mode/json"),i.container.getElementsByClassName("ace_scrollbar-v")[0].style.width="4px",i.setValue(JSON.stringify(e,null,2)),this.editor=i}e.app.gmxTimeline&&"false"!==e.app.gmxTimeline&&(L.gmxUtil.requestLink("//maps.kosmosnimki.ru/api/plugins/timeline/2.9.1/timeline.js"),L.gmxUtil.requestLink("//maps.kosmosnimki.ru/api/plugins/timeline/2.9.1/timeline.css"),L.gmxUtil.requestLink("//maps.kosmosnimki.ru/api/plugins/external/GMXPluginTimeLine/L.Control.gmxTimeLine.js"),L.gmxUtil.requestLink("//maps.kosmosnimki.ru/api/plugins/external/GMXPluginTimeLine/L.Control.gmxTimeLine.css"))},getPermalink:function(e){var t=this,i={};e&&fetch(oe+"TinyReference/Get.ashx?WrapStyle=None&id="+e,{mode:"cors",credentials:"include"}).then(function(e){return e.json()}).then(function(e){"ok"===e.Status&&(i=e.Result?JSON.parse(e.Result):{}),t.checkPermalink(i)})}};function de(e){var t=e.changed,i=e.current;e.previous;if(t.urlParams){var n=i.urlParams.config||"M6QMS";this.getPermalink(n)}}function ue(e){var t=this._svelte,i=t.component,n=t.ctx;i.checkMe(n.it,this)}function he(e,t,i){var n=Object.create(e);return n.it=t[i],n}function me(e,t){for(var i,n,r,a,h,m,f=t.dropdownMenu,p=[],v=0;v<f.length;v+=1)p[v]=fe(e,he(t,f,v));return{c:function(){i=d("div"),n=d("div"),r=d("div"),a=d("div");for(var e=0;e<p.length;e+=1)p[e].c();h=u("\n\t\t\t"),m=d("div"),a.className="dropdownMenuWidget svelte-gw2s3e",r.className="sidebarPanel-toolbarContainer svelte-gw2s3e",m.id="editor",m.className="editor svelte-gw2s3e",n.className="sidebarPanel svelte-gw2s3e",i.className="editor-sidebarContainer editor_sidebarExpanded svelte-gw2s3e"},m:function(e,t){o(e,i,t),s(i,n),s(n,r),s(r,a);for(var l=0;l<p.length;l+=1)p[l].m(a,null);s(n,h),s(n,m)},p:function(t,i){if(t.dropdownMenu){f=i.dropdownMenu;for(var n=0;n<f.length;n+=1){var r=he(i,f,n);p[n]?p[n].p(t,r):(p[n]=fe(e,r),p[n].c(),p[n].m(a,null))}for(;n<p.length;n+=1)p[n].d(1);p.length=f.length}},d:function(e){e&&l(i),c(p,e)}}}function fe(e,t){var i,n,r,a,c,h,p,g=t.it.title;return{c:function(){i=d("div"),n=d("i"),a=u("\n\t\t\t\t\t"),c=d("span"),h=u(g),n.className=r="icon-"+t.it.name+" svelte-gw2s3e",i._svelte={component:e,ctx:t},m(i,"click",ue),i.className=p="dropdownMenuWidget-item"+(t.it.checked?" checked":"")+" svelte-gw2s3e"},m:function(e,t){o(e,i,t),s(i,n),s(i,a),s(i,c),s(c,h)},p:function(e,a){t=a,e.dropdownMenu&&r!==(r="icon-"+t.it.name+" svelte-gw2s3e")&&(n.className=r),e.dropdownMenu&&g!==(g=t.it.title)&&v(h,g),i._svelte.ctx=t,e.dropdownMenu&&p!==(p="dropdownMenuWidget-item"+(t.it.checked?" checked":"")+" svelte-gw2s3e")&&(i.className=p)},d:function(e){e&&l(i),f(i,"click",ue)}}}function pe(e,t){var i,n={conf:t.conf},r=new se({root:e.root,store:e.store,data:n});return{c:function(){r._fragment.c()},m:function(e,t){r._mount(e,t),i=!0},p:function(e,t){var i={};e.conf&&(i.conf=t.conf),r._set(i)},i:function(e,t){i||this.m(e,t)},o:function(e){i&&(r&&r._fragment.o(e),i=!1)},d:function(e){r.destroy(e)}}}function ve(e){var t=this;b(this,e),this._state=i({share:!1,conf:"",urlParams:{},dropdownMenu:[{name:"refresh",title:"Refresh"},{name:"link",title:"Share",checked:!1}],map:null,permalink:null},e.data),this._intro=!!e.intro,this._handlers.state=[de],de.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(e,t){var i,n,a,s,c,m={},f=t.urlParams.edit&&me(e,t),p={permalink:t.permalink};void 0!==t.map&&(p.map=t.map,m.map=!0);var v=new re({root:e.root,store:e.store,data:p,_bind:function(t,i){var n={};!m.map&&t.map&&(n.map=i.map),e._set(n),m={}}});e.root._beforecreate.push(function(){v._bind({map:1},v.get())});var g=t.share&&pe(e,t);return{c:function(){f&&f.c(),i=u("\n"),n=d("div"),v._fragment.c(),a=u("\n"),g&&g.c(),s=h(),n.className="editor-viewerContainer editor_sidebarExpanded svelte-gw2s3e"},m:function(e,t){f&&f.m(e,t),o(e,i,t),o(e,n,t),v._mount(n,null),o(e,a,t),g&&g.m(e,t),o(e,s,t),c=!0},p:function(n,r){(t=r).urlParams.edit?f?f.p(n,t):((f=me(e,t)).c(),f.m(i.parentNode,i)):f&&(f.d(1),f=null);var a={};n.permalink&&(a.permalink=t.permalink),!m.map&&n.map&&(a.map=t.map,m.map=void 0!==t.map),v._set(a),m={},t.share?(g?g.p(n,t):(g=pe(e,t))&&g.c(),g.i(s.parentNode,s)):g&&g.o(function(){g.d(1),g=null})},i:function(e,t){c||this.m(e,t)},o:function(e){c&&(e=r(e,2),v&&v._fragment.o(e),g?g.o(e):e(),c=!1)},d:function(e){f&&f.d(e),e&&(l(i),l(n)),v.destroy(),e&&l(a),g&&g.d(e),e&&l(s)}}}(this,this._state),this.root._oncreate.push(function(){t.fire("update",{changed:n({},t._state),current:t._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),_(this)),this._intro=!0}i(ve.prototype,x),i(ve.prototype,ce);var ge,ye=(ge={},location.search.substr(1).split("&").forEach(function(e){var t=e.split("=");ge[t[0]]=t[1]}),ge);return new ve({target:document.body,data:{urlParams:ye,name:"world"}})}(L);
//# sourceMappingURL=winnie_2.0.js.map
